<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Saveior | Accounts</title>
		<link
			rel="icon"
			href="https://raw.githubusercontent.com/Zetcor/Saveior/main/boink.png"
			type="image/x-icon"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<script
			src="https://kit.fontawesome.com/203f7bcb2a.js"
			crossorigin="anonymous"
		></script>
		<link rel="stylesheet" href="styles.css" />
		<link rel="stylesheet" href="accounts.css" />
	</head>
	<body>
		<div class="rounded-container">
			<!-- Navbar -->
			<nav class="navbar navbar-expand-lg container-fluid sticky-top">
				<div class="navbar-container">
					<a class="nav-logo text-decoration-none fs-4" href="index.html">
						<img
							src="https://raw.githubusercontent.com/Zetcor/Saveior/main/boink.png"
							alt="Logo"
						/>
						Saveior
					</a>
				</div>

				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<div
						class="collapse navbar-collapse justify-content-center"
						id="navbarSupportedContent"
					>
						<ul
							class="nav flex-lg-row flex-column text-center gap-3 navbar-container"
						>
							<li class="nav-item">
								<a class="nav-link text-light px-4" href="dashboard.html">Dashboard</a>
							</li>
							<li class="nav-item">
								<a class="nav-link text-light px-4" href="index.html"
									>Records</a
								>
							</li>
							<li class="nav-item">
								<a class="nav-link text-light px-4" href="#">Budgets</a>
							</li>
							<li class="nav-item">
								<a class="nav-link px-4 active" href="accounts.html"
									>Accounts</a
								>
							</li>
							<li class="nav-item">
								<a class="nav-link text-light px-4" href="#">Categories</a>
							</li>
							<li class="nav-item">
								<a class="nav-link text-light px-4" href="savings.html"
									>Savings</a
								>
							</li>
						</ul>
					</div>
					<div class="ms-lg-auto mt-2 mt-lg-0">
						<div
							class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-end text-center"
						>
							<button class="icon-btn d-none d-lg-flex">
								<i class="fa-solid fa-gear"></i>
							</button>
							<button class="icon-btn d-none d-lg-flex">
								<i class="fa-solid fa-user"></i>
							</button>
						</div>
					</div>
				</div>
			</nav>

			<!-- Content -->
			<div class="tracker-container" style="margin-top: 40px">
				<div class="calculator-container" style="flex: 1 1 100%">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<h4 class="m-0 fw-bold">Accounts</h4>
						<div class="accounts-toolbar d-flex gap-2">
							<button
								id="openAddAccountModal"
								class="btn btn-success"
								data-bs-toggle="modal"
								data-bs-target="#accountModal"
							>
								<i class="bi bi-plus-circle"></i> Add Account
							</button>
						</div>
					</div>

					<div id="accountsList" class="row g-3"></div>

					<div id="emptyState" class="empty-state d-none mt-3">
						<div class="mb-1">
							<i class="bi bi-wallet2"></i> No accounts yet.
						</div>
						<div class="mb-2">
							Create your first account to track balances easily.
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Add Account Modal -->
		<div class="modal fade" id="accountModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<form id="accountForm" class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Add Account</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Account Name</label>
							<input
								type="text"
								class="form-control"
								id="newAccountName"
								placeholder="e.g., Cash, Debit Card"
								required
							/>
						</div>
						<div class="mb-3">
							<label class="form-label">Initial Amount</label>
							<input
								type="number"
								min="0"
								step="0.01"
								class="form-control"
								id="initialAmount"
								placeholder="e.g., 1000"
								required
							/>
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-light" data-bs-dismiss="modal" type="button">
							Cancel
						</button>
						<button class="btn btn-success" type="submit">
							<i class="bi bi-check2-circle"></i> Save
						</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Account Detail Modal -->
		<div
			class="modal fade"
			id="accountDetailModal"
			tabindex="-1"
			aria-hidden="true"
		>
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="accountTitle">Account Details</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body text-center">
						<h3 class="fw-bold">Balance</h3>
						<h2 id="accountBalance" class="text-success fw-bold mb-3">₱0.00</h2>
						<div class="d-flex justify-content-center gap-2 mb-3">
							<button id="addFundsBtn" class="btn btn-success">
								<i class="bi bi-plus-circle"></i> Add Funds
							</button>
							<button id="withdrawFundsBtn" class="btn btn-warning">
								<i class="bi bi-dash-circle"></i> Withdraw
							</button>
						</div>
					</div>
					<div class="modal-footer">
						<button id="deleteAccountBtn" class="btn btn-outline-danger">
							<i class="bi bi-trash3"></i> Delete Account
						</button>
						<button class="btn btn-light" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Add/Withdraw Modal -->
		<div class="modal fade" id="fundModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<form id="fundForm" class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="fundModalTitle">Add Funds</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Amount</label>
							<input
								type="number"
								min="0"
								step="0.01"
								class="form-control"
								id="fundAmount"
								placeholder="Enter amount"
								required
							/>
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-light" data-bs-dismiss="modal" type="button">
							Cancel
						</button>
						<button class="btn btn-success" type="submit">
							<i class="bi bi-check2-circle"></i> Confirm
						</button>
					</div>
				</form>
			</div>
		</div>

		<script>
			const ACCOUNTS_KEY = 'saveior.accounts';
			let currentAccountId = null;
			let fundAction = null;

			function ensureDefaults() {
				const current = JSON.parse(
					localStorage.getItem(ACCOUNTS_KEY) || 'null'
				);
				if (Array.isArray(current) && current.length) return;
				const defaults = [
					{ id: crypto.randomUUID(), name: 'Cash', balance: 0 },
					{ id: crypto.randomUUID(), name: 'Credit Card', balance: 0 },
					{ id: crypto.randomUUID(), name: 'Debit Card', balance: 0 },
				];
				localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(defaults));
			}

			function getAccounts() {
				return JSON.parse(localStorage.getItem(ACCOUNTS_KEY) || '[]');
			}

			function setAccounts(list) {
				localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(list));
			}

			function iconFor(name) {
				const t = (name || '').toLowerCase();
				if (t.includes('credit'))
					return '<i class="fa-solid fa-credit-card"></i>';
				if (t.includes('debit'))
					return '<i class="fa-regular fa-credit-card"></i>';
				if (t.includes('cash')) return '<i class="fa-solid fa-money-bill"></i>';
				return '<i class="fa-solid fa-wallet"></i>';
			}

			const accountsList = document.getElementById('accountsList');
			const emptyState = document.getElementById('emptyState');

			function render() {
				const accounts = getAccounts();
				accountsList.innerHTML = '';
				emptyState.classList.toggle('d-none', accounts.length > 0);

				accounts.forEach((acc) => {
					const col = document.createElement('div');
					col.className = 'col-12';
					col.innerHTML = `
						<div class="goal-card p-3" data-id="${acc.id}" style="cursor:pointer;">
							<div class="d-flex justify-content-between align-items-center">
								<div class="goal-name">${iconFor(acc.name)} ${acc.name}</div>
								<div class="balance-lg">₱${Number(acc.balance || 0).toLocaleString('en-US', {
									minimumFractionDigits: 2,
									maximumFractionDigits: 2,
								})}</div>
							</div>
						</div>
					`;

					col
						.querySelector('.goal-card')
						.addEventListener('click', () => openAccountDetail(acc.id));
					accountsList.appendChild(col);
				});
			}

			document.getElementById('accountForm').addEventListener('submit', (e) => {
				e.preventDefault();
				const name = document.getElementById('newAccountName').value.trim();
				const amount = parseFloat(
					document.getElementById('initialAmount').value
				);
				if (!name) return alert('Please enter an account name.');
				if (isNaN(amount) || amount < 0)
					return alert('Please enter a valid amount.');
				const accounts = getAccounts();
				if (accounts.some((a) => a.name.toLowerCase() === name.toLowerCase())) {
					alert('Account name already exists.');
					return;
				}
				accounts.push({ id: crypto.randomUUID(), name, balance: amount });
				setAccounts(accounts);
				bootstrap.Modal.getInstance(
					document.getElementById('accountModal')
				).hide();
				render();
			});

			function openAccountDetail(id) {
				currentAccountId = id;
				const accounts = getAccounts();
				const acc = accounts.find((a) => a.id === id);
				if (!acc) return;

				document.getElementById('accountTitle').textContent = acc.name;
				document.getElementById('accountBalance').textContent =
					'₱' +
					Number(acc.balance || 0).toLocaleString('en-US', {
						minimumFractionDigits: 2,
						maximumFractionDigits: 2,
					});

				document.getElementById('addFundsBtn').onclick = () => {
					fundAction = 'add';
					document.getElementById('fundModalTitle').textContent = 'Add Funds';
					document.getElementById('fundForm').reset();
					bootstrap.Modal.getOrCreateInstance(
						document.getElementById('fundModal')
					).show();
				};
				document.getElementById('withdrawFundsBtn').onclick = () => {
					fundAction = 'withdraw';
					document.getElementById('fundModalTitle').textContent =
						'Withdraw Funds';
					document.getElementById('fundForm').reset();
					bootstrap.Modal.getOrCreateInstance(
						document.getElementById('fundModal')
					).show();
				};
				document.getElementById('deleteAccountBtn').onclick = () => {
					if (!confirm(`Delete account "${acc.name}"?`)) return;
					setAccounts(accounts.filter((a) => a.id !== id));
					bootstrap.Modal.getInstance(
						document.getElementById('accountDetailModal')
					).hide();
					render();
				};

				bootstrap.Modal.getOrCreateInstance(
					document.getElementById('accountDetailModal')
				).show();
			}

			document.getElementById('fundForm').addEventListener('submit', (e) => {
				e.preventDefault();
				const amt = parseFloat(document.getElementById('fundAmount').value);
				if (!(amt > 0)) return alert('Enter a valid amount.');
				const accounts = getAccounts();
				const acc = accounts.find((a) => a.id === currentAccountId);
				if (!acc) return;
				if (fundAction === 'add') acc.balance += amt;
				else if (fundAction === 'withdraw')
					acc.balance = Math.max(0, acc.balance - amt);
				setAccounts(accounts);
				bootstrap.Modal.getInstance(
					document.getElementById('fundModal')
				).hide();
				openAccountDetail(currentAccountId);
				render();
			});

			ensureDefaults();
			render();

			window.addEventListener('focus', () => {
				render();
			});

			window.addEventListener('storage', (e) => {
				if (e.key === 'saveior.accounts') render();
			});
		</script>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
